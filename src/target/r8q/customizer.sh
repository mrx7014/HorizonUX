#!/usr/bin/env bash
#
# Copyright (C) 2025 Luna
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

# device blob path and etc...
BUILD_TARGET_BLOB_PATH="./target/r8q/patches/stock_blobs"

if [[ "$(grep_prop "ro.product.vendor.device" "$HORIZON_VENDOR_PROPERTY_FILE")" == *"r8q"* && -f "${VENDOR_DIR}/etc/fstab.qcom" ]]; then
    console_print "Customizing experience for Galaxy S20 FE..."
    setprop --custom "${VENDOR_DIR}/default.prop" "log.tag.stats_log" "D"
    setprop --custom "${VENDOR_DIR}/default.prop" "persist.sys.usb.config" "mtp,adb"
    boolReturn "${BUILD_TARGET_ADD_FRAMEWORK_OVERLAY_TO_FIX_CUTOUT}" && build_and_sign "./target/r8q/overlay/framework-res/" "${VENDOR_DIR}"
    if boolReturn $BUILD_TARGET_ADD_EXTRA_CAMERA_MODE; then
        if ask "Enabling extra camera modes can cause it to crash, please add or remove stuffs if you have any issues, do you wanna proceed?"; then
            for experimentalCameraFeatures in SUPPORT_BACK_WIDE_NORMAL_DUAL_PORTRAIT SUPPORT_SEAMLESS_ZOOM SUPPORT_FOOD_SEAMLESS_ZOOM SUPPORT_WIDE_LENS_CORRECTION SUPPORT_NIGHT_MODE_ZOOM SUPPORT_NIGHT_MODE_REAR_LENS \
                SUPPORT_TAP_AND_HOLD_CAMERA_BUTTON SUPPORT_INTELLIGENT_RECOGNITION_TIPS SUPPORT_LIVE_FOCUS_TORCH_FLASH SUPPORT_LIVE_FOCUS_HDR_CAPTURE SUPPORT_DUAL_BOKEH_EFFECT SUPPORT_SINGLE_BOKEH_EFFECT \
                SUPPORT_BOKEH_FOCUSED_REGION SUPPORT_VIDEO_BOKEH_EFFECT SUPPORT_LIVE_FOCUS_BIG_BOKEH_EFFECT SUPPORT_LIVE_FOCUS_VIDEO_BEAUTY SUPPORT_LIVE_FOCUS_BACK_CAMERA_ANGLE_CHANGE_BY_ZOOM SUPPORT_CONTROL_VIDEO_BOKEH_EFFECT_IN_RECORDING \
                SUPPORT_COMPOSITION_GUIDE SUPPORT_ADDITIONAL_EFFECTS_WITH_SCENE_DETECTION SUPPORT_FLOATING_CAMERA_BUTTON SUPPORT_LIVE_BEAUTY_IN_AUTO_MODE SUPPORT_BACK_VIDEO_BEAUTY SUPPORT_BODY_BEAUTY \
                SUPPORT_BEAUTY_BRIGHTEN SUPPORT_SAVE_AS_FLIPPED_IN_MEDIA_RECORDER SUPPORT_HEIF_FORMAT SUPPORT_SUPER_SLOW_MOTION_FRC_AUTO_CHANGE SUPPORT_SUPER_SLOW_MOTION_AUTO_DETECT_PREPARE \
                SUPPORT_TORCH_HIGH_TEMPERATURE_WARNING SUPPORT_VIDEO_STABILIZATION_WITH_TRACKING_AF SUPPORT_POST_PICTURE_PROCESSING SUPPORT_POST_PROCESSING_MOTION_PHOTO SUPPORT_LEVEL_METER SUPPORT_AUTO_HDR_MENU \
                SUPPORT_EXPAND_SHUTTER_SPEED SUPPORT_VDIS_CENTER_CROP_FOR_PREVIEW_RECORDING SUPPORT_QUICK_TAKE SUPPORT_MY_FILTER SUPPORT_PHOTO_NIGHT SUPPORT_ZOOM_MAP_VIEW SUPPORT_POST_PROCESSING_NIGHT_SHOT \
                SUPPORT_LIVE_FOCUS_SCENE_DETECTION_MODE SUPPORT_FRONT_SUPER_LARGE_RESOLUTION SUPPORT_SENSOR_CROP SUPPORT_ADDITIONAL_SCENE_DOCUMENT_SCAN SUPPORT_SUPER_VIDEO_STABILIZATION_LENS_CHANGE \
                SUPPORT_VIDEO_STABILISATION_MENU_IN_SETTING SUPPORT_SUPER_VIDEO_STABILIZATION SUPPORT_ADDITIONAL_SCENE_BRIGHT_NIGHT SUPPORT_TOUCH_VIBRATIONS SUPPORT_TRANSIENT_CAPTURE_ACTION SUPPORT_VIDEO_PALM_DETECTION \
                SUPPORT_MOTION_PHOTO_IN_SUPER_LARGE_RESOLUTION SUPPORT_SMART_SCAN_EXTRACT_TEXT SUPPORT_SCALE_UP_ANIMATION_FOR_QUICKVIEW SUPPORT_HYPER_LAPSE_SUPER_STEADY SUPPORT_HYPER_LAPSE_NIGHT_AUTO \
                SUPPORT_FLASH_IN_WIDE_LENS SUPPORT_HISTOGRAM SUPPORT_SWITCH_FACING_WHILE_RECORDING SUPPORT_FRONT_CAMERA_DYNAMIC_FOV SUPPORT_SELFIE_TONE_MODE SUPPORT_SMART_SCAN_MANUAL_CROP \
                SUPPORT_NIGHT_MODE_FRONT_ANGLE SUPPORT_QR_CODE_DETECTION SUPPORT_PRO_VIDEO_RESOLUTION_SETTING SUPPORT_PRO_VIDEO_ZOOM_ROCKER SUPPORT_PRO_VIDEO_RESET SUPPORT_PRO_RESET SUPPORT_PRO_VIDEO_AUDIO_INPUT_CONTROL  \
                SUPPORT_PRO_VIDEO_AUDIO_BLUETOOTH_MIX_MIC SUPPORT_BACK_WIDE_PRO SUPPORT_SINGLE_TAKE_EXTENDED_CAPTURE SUPPORT_SINGLE_TAKE_CUSTOMIZED_OPTION SUPPORT_SINGLE_TAKE_HIGHLIGHT_VIDEOS SUPPORT_CAMERA_APP_ENTRY_PERFORMANCE; do
                    manageCameraFeatures --add "${experimentalCameraFeatures}" "value=\"true\"" "SUPPORT_" "${SYSTEM_DIR}/cameradata/camera-feature.xml"
            done
        fi
    fi
    replaceTargetBuildProperties "r8q"
fi